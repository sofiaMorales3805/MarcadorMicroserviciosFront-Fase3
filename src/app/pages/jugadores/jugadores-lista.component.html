<section class="wrap">
  <header class="hdr">
        <button class="btn" [routerLink]="['/dashboard']">← Regresar</button>
    <h2>Gestión de Jugadores</h2>
    <div class="actions"> 
      <button class="btn primary" (click)="crear()">+ Nuevo jugador</button>
    </div>
  </header>

  <div class="filters">
    <input type="text" placeholder="Buscar por nombre..." [(ngModel)]="search" (input)="onBuscarChange()"/>
    <input type="text" placeholder="Filtrar por nombre de equipo..." [(ngModel)]="equipoNombre" (input)="onBuscarChange()"/>
    <input type="text" placeholder="Filtrar por posición..." [(ngModel)]="posicion" (input)="onBuscarChange()"/>
    <select [(ngModel)]="equipoId" (change)="cargarLista()">
      <option [ngValue]="null">-- Equipo (ID) --</option>
      <option *ngFor="let e of equipos()" [ngValue]="e.id">{{ e.id }} - {{ e.nombre }}</option>
    </select>
    <button class="btn" (click)="limpiarFiltros()">Limpiar</button>
  </div>

  <div *ngIf="cargando()" class="info">Cargando...</div>
  <div *ngIf="errorMsg()" class="err">{{ errorMsg() }}</div>

  <table class="tbl" *ngIf="!cargando()">
    <thead>
      <tr>
        <th (click)="toggleSort('nombre')" style="cursor:pointer">Nombre</th>
        <th (click)="toggleSort('equipo')" style="cursor:pointer">Equipo</th>
        <th (click)="toggleSort('posicion')" style="cursor:pointer">Posición</th>
        <th (click)="toggleSort('puntos')" style="cursor:pointer">Puntos</th>
        <th (click)="toggleSort('faltas')" style="cursor:pointer">Faltas</th>
        <th style="width: 180px;">Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let j of jugadores(); trackBy: trackById">
        <td>{{ j.nombre }}</td>
        <td>{{ j.equipoNombre }}</td>
        <td>{{ j.posicion || '-' }}</td>
        <td>{{ j.puntos }}</td>
        <td>{{ j.faltas }}</td>
        <td>
          <div class="row-actions">
            <button class="btn" (click)="editar(j)">Editar</button>
            <button class="btn danger" (click)="eliminar(j)">Eliminar</button>
          </div>
        </td>
      </tr>
      <tr *ngIf="!hasRows">
        <td colspan="6" class="empty">Sin resultados.</td>
      </tr>
    </tbody>
  </table>

  <div class="pager" *ngIf="totalItems > 0">
    <div>Mostrando {{ rangeStart }}–{{ rangeEnd }} de {{ totalItems }}</div>
    <div class="btns">
      <button class="btn" (click)="goPage(page-1)" [disabled]="page<=1">Anterior</button>
      <span>Página {{ page }} / {{ totalPages }}</span>
      <button class="btn" (click)="goPage(page+1)" [disabled]="page>=totalPages">Siguiente</button>
      <select [ngModel]="pageSize" (ngModelChange)="changePageSize($event)">
        <option [ngValue]="5">5</option>
        <option [ngValue]="10">10</option>
        <option [ngValue]="20">20</option>
      </select>
    </div>
  </div>
</section>

<!-- Modal -->
<div class="modal-backdrop" *ngIf="modalVisible()">
  <div class="modal">
    <app-jugador-form
      [modo]="modo"
      [inicial]="seleccionado"
      (saved)="onFormSaved()"
      (cancelled)="onFormCancelled()"
    ></app-jugador-form>
  </div>
</div>
